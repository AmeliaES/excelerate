---
title: "Introduction to excelerate"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Get started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction
This vignette demonstrates how to use the `excelerate` package to create supplementary tables from example datasets. We will prepare CSV and .cols metadata files, and then generate Excel spreadsheets.

```{r setup}
library(excelerate)

# Set up temporary directory
temp_dir <- tempdir()
```

## Preparing Example Datasets
First, we load and save example datasets as CSV files. We use the built-in datasets: iris, ChickWeight, ToothGrowth, and CO2.

```{r}
# Load example datasets
dataset_names <- c("iris", "ChickWeight", "ToothGrowth", "CO2")
for (dataset in dataset_names) {
  data(list = dataset, package = "datasets")
}

# Save datasets as CSV files
for (dataset in dataset_names) {
  write.csv(get(dataset), file = file.path(temp_dir, paste0("/", dataset, ".csv")), row.names = FALSE)
}
```

## Creating Metadata Files
We then create .cols sidecar metadata files for each dataset using the `create_meta()` function. This file contains column names and descriptions to ensure the generated excel file is easy to understand.

```{r}
create_meta(file_name = file.path(temp_dir, "iris.csv"),
            table_variable_name = iris,
            colname_descriptions = c("Sepal.Length" = "Length of the sepal in cm",
                                      "Sepal.Width" = "Width of the sepal in cm",
                                      "Petal.Length" = "Length of the petal in cm",
                                      "Petal.Width" = "Width of the petal in cm",
                                      "Species" = "Species of iris"))

create_meta(file_name = file.path(temp_dir, "ChickWeight.csv"),
            table_variable_name = ChickWeight,
            colname_descriptions = c("weight" = "Weight of the chick in grams",
                                      "Time" = "Time in days",
                                      "Chick" = "Chick identifier",
                                      "Diet" = "Diet type"))

create_meta(file_name = file.path(temp_dir, "ToothGrowth.csv"),
            table_variable_name = ToothGrowth,
            colname_descriptions = c("len" = "Tooth length in mm",
                                      "supp" = "Supplement type (VC or OJ)",
                                      "dose" = "Dose of the supplement in mg"))

create_meta(file_name = file.path(temp_dir, "CO2.csv"),
            table_variable_name = CO2,
            colname_descriptions = c("Plant" = "Identifier for the plant",
                                      "Type" = "Type of plant (Quebec or Mississippi)",
                                      "Treatment" = "Treatment type (nonchilled or chilled)",
                                      "conc" = "Concentration of CO2 in uL/L",
                                      "uptake" = "CO2 uptake in mg"))
```

## Generating Supplementary Tables
Next, we demonstrate how to combine sheets into a single Excel file using the `sheet()`, `spreadsheet()` and `excelerate()` functions. In the below example we create two supplementary tables, each containing multiple sheets with metadata and data from the example datasets. These are saved as Excel files in the temporary directory with the names `supplementary_table_1.xlsx` and `supplementary_table_2.xlsx`.

```{r}
supplementary_table_1 <- spreadsheet(
  sheet(temp_dir, "iris", "iris", "sheet_legend for the iris dataset."),
  sheet(temp_dir, "ChickWeight", "ChickWeight", "sheet_legend for the ChickWeight dataset."),
  title = "Supplementary Table 1. Example of output from excelerate(). This is the legend_title passed to spreadsheet().",
  filename = file.path(temp_dir, "supplementary_table_1.xlsx"))

supplementary_table_2 <- spreadsheet(
  sheet(temp_dir, "ToothGrowth", "ToothGrowth", "sheet_legend for the ToothGrowth dataset."),
  sheet(temp_dir, "CO2", "CO2", "sheet_legend for the CO2 dataset."),
  title = "Supplementary Table 2. Example of output from excelerate(). This is the legend_title passed to spreadsheet().",
  filename = file.path(temp_dir, "supplementary_table_2.xlsx"))

# Save supplementary tables as .xlsx to temp_dir
excelerate(supplementary_table_1,
           supplementary_table_2)
```
## Conclusion
This vignette has demonstrated how to create supplementary tables using the `excelerate` package in R. We prepared example datasets, created metadata files, and generated Excel spreadsheets with multiple sheets. The `excelerate` package simplifies the process of creating well-structured and documented Excel files for data analysis and reporting.

