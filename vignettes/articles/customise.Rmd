---
title: "Customise output from excelerate"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

You may want to customise your supplementary tables further. For example, perhaps you want to bold certain rows in certain sheets based on a condition (eg. make rows bold if the p-value column is < 0.05).

The best way to do this is create your supplementary table Excel files with excelerate. Then use another R package to open that excel file and customise it further. This article is an example of how to do this using the [`openxlsx`](https://ycphs.github.io/openxlsx/) R package, as this is the package that `excelerate` uses for it's main functionality.

## Create Excel files with `excelerate`

Use `excelerate` as demonstrated in [`Get Started`](https://ameliaes.github.io/excelerate/articles/excelerate.html):

```{r}
library(excelerate)

# Set up temporary directory to save the excel spreadsheets in
temp_dir <- tempdir()

# Load example datasets
datasets <- list(iris, ChickWeight, ToothGrowth, CO2)

iris_commented <- append_meta(
  results = iris,
  colname_descriptions = c(
    "Sepal.Length" = "Length of the sepal in cm",
    "Sepal.Width" = "Width of the sepal in cm",
    "Petal.Length" = "Length of the petal in cm",
    "Petal.Width" = "Width of the petal in cm",
    "Species" = "Species of iris"
  )
)

chickweight_commented <- append_meta(
  results = ChickWeight,
  colname_descriptions = c(
    "weight" = "Weight of the chick in grams",
    "Time" = "Time in days",
    "Chick" = "Chick identifier",
    "Diet" = "Diet type"
  )
)

toothgrowth_commented <- append_meta(
  results = ToothGrowth,
  colname_descriptions = c(
    "len" = "Tooth length in mm",
    "supp" = "Supplement type (VC or OJ)",
    "dose" = "Dose of the supplement in mg"
  )
)
co2_commented <- append_meta(
  results = CO2,
  colname_descriptions = c(
    "Plant" = "Identifier for the plant",
    "Type" = "Type of plant (Quebec or Mississippi)",
    "Treatment" = "Treatment type (nonchilled or chilled)",
    "conc" = "Concentration of CO2 in uL/L",
    "uptake" = "CO2 uptake in mg"
  )
)

supplementary_table_1 <- spreadsheet(
  title = "Results for iris and ChickWeight. 'title' from spreadsheet().",
  path = file.path(temp_dir),
  file = "",
  sheet(
    iris_commented,
    "iris sheet_name",
    "sheet_legend for the iris dataset."
  ),
  sheet(
    chickweight_commented,
    "ChickWeight sheet_name",
    "sheet_legend for the ChickWeight dataset."
  )
)

supplementary_table_2 <- spreadsheet(
  title = "Results for toothgrowth and C02 R supplied datasets.",
  path = file.path(temp_dir),
  file = "",
  sheet(
    toothgrowth_commented,
    "ToothGrowth sheet_name",
    "sheet_legend for the ToothGrowth dataset."
  ),
  sheet(
    co2_commented,
    "CO2 sheet_name",
    "sheet_legend for the CO2 dataset."
  )
)

# Save supplementary tables as .xlsx to temp_dir
excelerate(
  supplementary_table_1,
  supplementary_table_2
)

# Check files were made successfully
list.files(temp_dir, pattern = "\\.xlsx$", full.names = TRUE)
```

## Customise supplementary tables

In this example we will make all cells in a row bold if the column "Petal.Width" is < 0.3, from the iris dataset. 

The iris data was inserted into "S1.xlsx" in the above code chunk, with the sheet name "iris sheet_name". 

Remember that sheet names are automatically by default prefixed with "A1", "B1" etc. if it's Supplementary Table 1, and "A2", "B2" etc. if it's Supplementary Table 2.

```{r}
# Create custom function to bold rows based on a certain condition
# using the openxlsx R package
library(openxlsx)

# ------- WRITE FUNCTION -----------------
# Write a function to style rows and resave Excel files
style_rows <- function(data, wb, row_indices,
                       style_type, path_file, sheet_name) {
  # Create a style
  style <- openxlsx::createStyle(textDecoration = "bold")

  # Apply style to all columns in the selected rows
  openxlsx::addStyle(
    wb,
    sheet = sheet_name,
    style = style,
    rows = row_indices_to_style + 1, # +1 because first row is the header
    cols = seq_len(ncol(data)),
    gridExpand = TRUE
  )

  # Resave Excel file
  saveWorkbook(wb, file = path_file, overwrite = TRUE)
}

# ------- USE FUNCTIONS ------------------
# Read in S1.xlsx, the file generated by excelerate(), with the iris sheet
wb <- openxlsx::loadWorkbook(file.path(temp_dir, "S1.xlsx"))

iris_data <- openxlsx::read.xlsx(wb, sheet = "1A iris sheet_name")

# Get the index of the rows that we want to make bold
row_indices_to_style <- which(iris_data$Petal.Width < 0.3)

# Make the rows bold and resave the Excel file
style_rows(
  iris_data,
  wb,
  row_indices_to_style,
  "bold",
  file.path(temp_dir, "S1.xlsx"),
  "1A iris sheet_name"
)

# Reopen the Excel file and browse the sheet with the iris data
# You should see some of the rows (where Petal.Width < 0.3) are in bold now
browseURL(file.path(temp_dir, "S1.xlsx"))
```

This article is a demonstration on how to use the output from `excelerate()` to customise your supplementary tables further. For more details see the [`openxlsx`](https://ycphs.github.io/openxlsx/) R package to write your own functions to customise your tables.
